# =============================================================================
# Doctor Sample Unit (DSU) - Shared Runtime Requirements
# Platform: macOS Apple Silicon (arm64) - MPS GPU Acceleration
# Python: 3.10
# =============================================================================
# Supports: BS-RoFormer, Audio-Separator, Demucs, Apollo
# Uses Metal Performance Shaders (MPS) for GPU acceleration
# =============================================================================

# -----------------------------------------------------------------------------
# PyTorch 2.10 for Apple Silicon with MPS (Metal)
# MPS supported in 2.10; 2.5+ had critical buffer-size fixes. We use 2.10.
# -----------------------------------------------------------------------------
torch>=2.10,<2.11
torchaudio>=2.10,<2.11
torchvision>=0.25,<0.26

# -----------------------------------------------------------------------------
# NumPy - Use numpy>=2 (tested compatible with all architectures)
# -----------------------------------------------------------------------------
numpy>=2.0.0

# -----------------------------------------------------------------------------
# Audio Processing Core
# audio-separator: installed separately with --no-deps (lighter, no onnx/huggingface)
# -----------------------------------------------------------------------------
librosa>=0.10.0
soundfile>=0.12.0
# samplerate: audio-separator pins 0.1.0, but 0.1.0 ships x86_64-only libsamplerate.dylib.
# On Mac ARM run after install: pip install 'samplerate>=0.2.3' --force-reinstall
# Build scripts (build_manual_mac.sh, build_runtime_mac_mps.sh, simulate_ci_mac_arm.sh) do this automatically.
# See docs/LIBSAMPLERATE_MAC_ARM.md
samplerate==0.1.0
pydub>=0.25.0
scipy>=1.10.0
resampy>=0.4.0

# Demucs (torchaudio.save uses torchcodec for WAV encode/decode; needs FFmpeg: brew install ffmpeg)
demucs>=4.0.0
torchcodec>=0.5

# -----------------------------------------------------------------------------
# ONNX - REMOVED: Dummy module in audio_separator_worker handles .pth-only models
# -----------------------------------------------------------------------------
# onnx>=1.14.0
# onnx2torch>=1.5.0
# onnxruntime>=1.16.0

# -----------------------------------------------------------------------------
# Model Dependencies
# -----------------------------------------------------------------------------
# asteroid, pedalboard, torch_audiomentations: training-only, lazy - not needed for inference
spafe                     # Required by Bandit (fbanks) - inference
einops>=0.7.0
julius>=0.2.7
diffq>=0.2.4              # Required for Demucs quantized models
beartype>=0.18.5,<0.19.0  # Required for BS-RoFormer
rotary-embedding-torch>=0.6.1,<0.7.0  # Required for BS-RoFormer

# -----------------------------------------------------------------------------
# Configuration & Utilities
# -----------------------------------------------------------------------------
requests>=2.28.0
tqdm>=4.65.0
six>=1.16.0
pyyaml>=6.0
omegaconf>=2.3.0
# huggingface-hub>=0.20.0  # REMOVED: Dummy module for Apollo local models
# pytorch-lightning>=2.0.0  # REMOVED: Training only, not needed for inference
ml-collections>=0.1.0
matplotlib

# -----------------------------------------------------------------------------
# Build Tools (optional - for creating frozen binaries)
# -----------------------------------------------------------------------------
cx-Freeze==6.15.16
